#/bin/bash

usage() {
	echo "A simple Task Manager
usage:
	$0 OPTION
	OPTION is:
	-n	task's name
	-d	task's descripton
	-u	view Unfinished task
	-i	view fInished task
	-a	view All task
	-f	task is done
	-c	Cancel a task
	-h	help
Power by <http://sqlite.org>"
	exit;
}

# define database name
db='tasks.db3'

if [[ "$#" -lt "1" ]]; then
	usage
fi

while getopts "n:d:uiaf:c:h" opt; do
  case $opt in
    n)
      name="$OPTARG"
      ;;
    d)
      des="$OPTARG"
      ;;
    u)
      sqlite3 -line ~/$db "SELECT T.id,T.name,T.comment,datetime(start,'localtime') AS start FROM tasks AS T INNER JOIN status AS S ON T.status = S.id WHERE status=0 AND end=0;"
      ;;
    i)
      sqlite3 -line ~/$db "SELECT T.id,T.name,T.comment,datetime(start,'localtime') AS start ,datetime(end,'localtime') AS end FROM tasks AS T INNER JOIN status AS S ON T.status = S.id WHERE status=1;"
      ;;
    a)
      sqlite3 ~/$db "SELECT T.id,T.name,T.comment,S.name AS status,start,end FROM tasks AS T INNER JOIN status AS S ON T.status = S.id LIMIT 50;"
      ;;
    f)
      sqlite3 -line ~/$db "UPDATE tasks SET status=1 , end=CURRENT_TIMESTAMP WHERE id = '$OPTARG' AND end=0; SELECT * FROM tasks WHERE id = '$OPTARG';"
      ;;
    c)
      sqlite3 -line ~/$db "UPDATE tasks SET status=2 , end=CURRENT_TIMESTAMP WHERE id = '$OPTARG' AND end=0; SELECT * FROM tasks WHERE id = '$OPTARG';"
      ;;
    h|*)
	usage
      ;;
  esac
done

if [[ ! -z "$name" && ! -z "$des" ]]; then
	sqlite3 ~/$db "INSERT INTO tasks (name,comment) VALUES ('$name','$des');"
elif [[ -z "$name" && -z "$des" ]]; then
	exit;
else
	echo "You have to set value for both name and description"
fi

